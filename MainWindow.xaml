<!-- ============================================================================
  ApolloGUI — MainWindow.xaml
  Purpose: Window layout: tree, preview pane, and bottom log area.
  Key UI elements: Window, Grid, DockPanel, ListView, TextBox, StatusBar.
  Notes: Keep Name attributes in sync with code-behind.
  Version: v1.0.0   Date: 2025-08-31
  Copyright (c) 2025 Skiller S
  ============================================================================
  Change Log:
    - v1.0.0 (2025-08-31): Repository-ready header added.
============================================================================ -->

<Window xmlns:local="clr-namespace:ApolloGUI" x:Class="ApolloGUI.MainWindow" xmlns:mods="clr-namespace:ApolloGUI"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="{x:Static local:AppInfo.WindowTitle}" Height="840" Width="1340"
        AllowDrop="True"
        DragOver="Window_DragOver" Drop="Window_Drop">
    <Window.Resources>
        <mods:ModPrefixConverter x:Key="ModPrefix"/>
    </Window.Resources>

  <Window.InputBindings>
    <KeyBinding Key="F5" Command="{x:Static local:MainWindow.RefreshCommand}"/>
    <KeyBinding Modifiers="Control" Key="O" Command="{x:Static local:MainWindow.AddPatchCommand}"/>
  </Window.InputBindings>
    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
    <MenuItem Header="_Refresh" Command="{x:Static local:MainWindow.RefreshCommand}" InputGestureText="F5"/>
    <MenuItem Header="_Add Patch…" Command="{x:Static local:MainWindow.AddPatchCommand}" InputGestureText="Ctrl+O"/>
    <MenuItem Header="_Collector..." Click="OpenCollector_Click"/>
    <Separator/>

                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Settings">
                <MenuItem Header="_Preferences..." Click="Preferences_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Top: paths + drop zones -->
        <StackPanel DockPanel.Dock="Top" Margin="10">
            <Grid Margin="0,0,0,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Database:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <ComboBox x:Name="cmbDb" Grid.Column="1" IsEditable="False" SelectionChanged="CmbDb_SelectionChanged"/>
                <TextBlock Text="Tools:" Grid.Column="3" VerticalAlignment="Center" Margin="10,0,6,0"/>
                <TextBox x:Name="txtTools" Grid.Column="4" IsReadOnly="True" />
            </Grid>
            <CheckBox x:Name="chkRecurse" Content="Search subfolders" Margin="0,0,0,6"/>


            <TextBlock x:Name="txtGame"
                       Text="Game: (none loaded)"
                       FontSize="16"
                       FontWeight="Bold"
                       Margin="0,0,0,6"/>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Drop zone for .savepatch -->
                <Border Grid.Column="0" BorderBrush="#888" BorderThickness="1" CornerRadius="6" Padding="12" MouseLeftButtonUp="DropPatch_Click">
                    <StackPanel>
                        <TextBlock Text="Drop .savepatch here (or click to browse)" FontWeight="SemiBold"/>
                        <TextBlock x:Name="lblPatchPath" Text="(none selected; use list at left)" Foreground="#666"/>
                    </StackPanel>
                </Border>

                <!-- spacer -->
                <Border Grid.Column="1" Background="Transparent"/>

                <!-- Drop zone for data file -->
                <Border Grid.Column="2" BorderBrush="#888" BorderThickness="1" CornerRadius="6" Padding="12" MouseLeftButtonUp="DropData_Click">
                    <StackPanel>
                        <TextBlock Text="Drop file to modify (.bin/.dat) here (or click to browse)" FontWeight="SemiBold"/>
                        <TextBlock x:Name="lblDataPath" Text="(none)" Foreground="#666"/>
                    </StackPanel>
                </Border>
            </Grid>
        </StackPanel>

        <!-- Main body -->
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="360"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="460"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="240"/>
            </Grid.RowDefinitions>

            <!-- Database list -->
            <GroupBox Header="Games (Database \ Apollo)" Grid.Column="0" Grid.Row="0">
                <DockPanel>
                    

  <Grid>

    <Grid.RowDefinitions>

      <RowDefinition Height="*"/>

      <RowDefinition Height="Auto"/>

    </Grid.RowDefinitions>

    <ListBox x:Name="lstGames" DisplayMemberPath="Display" SelectionChanged="LstGames_SelectionChanged">
                        <ListBox.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Open code in Notepad" Click="OpenInNotepad_Click"
                                          CommandParameter="{Binding SelectedItem, ElementName=lstGames}"/>
                            </ContextMenu>
                        </ListBox.ContextMenu>
                    </ListBox>

    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4,0,0">

      <ToggleButton x:Name="tglSortById" Width="92" Height="22" Margin="0,0,6,0"

                    Checked="SortToggle_Changed" Unchecked="SortToggle_Changed"

                    Content="Sort: Name" ToolTip="Toggle sort: Name ↔ ID"/>

      <TextBox x:Name="txtGameSearch" Width="140" Height="22"

               TextChanged="TxtGameSearch_TextChanged" ToolTip="Type to filter games"/>


    </StackPanel>

  </Grid>
                </DockPanel>
            </GroupBox>

            <!-- Codes checklist + search and select buttons + metadata -->
            <GroupBox Header="Codes" Grid.Column="2" Grid.Row="0">
                <DockPanel>
                    <!-- compact bar BELOW the games list -->

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="150"/>
                        </Grid.ColumnDefinitions>
                        <Grid Grid.Column="0">
  <Grid.RowDefinitions>
    <RowDefinition Height="Auto"/>
    <RowDefinition Height="*"/>
    <RowDefinition Height="Auto"/>
  </Grid.RowDefinitions>
  <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,6">
    <Button x:Name="btnMoveCheckedToCollector"
            Content="Move Checked to Collector"
            Click="MoveCheckedToCollector_Click"
            Padding="10,4" />
  </StackPanel>

  <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
    <ItemsControl x:Name="codesPanel">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <CheckBox Content="{Binding Name, Converter={StaticResource ModPrefix}}"
                                                  Tag="{Binding Index}"
                                                  Margin="4"
                                                  Checked="CodeCheckChanged"
                                                  Unchecked="CodeCheckChanged"
                                                  MouseEnter="Code_MouseEnter"
                                                  PreviewMouseLeftButtonDown="Code_MouseLeftButtonDown">
</CheckBox>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
  </ScrollViewer>
  <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,6,0,0" HorizontalAlignment="Stretch">
    <Button x:Name="btnResetAll" Height="28" Padding="12,2"
            Content="Reset All to Database"
            Click="ResetAllToDatabase_Click"
            ToolTip="Reset all codes back to their original lines from the loaded .savepatch database."/>
    <TextBlock Text="  " Width="8"/>
    <TextBlock Text="Right‑click a code for per‑item reset." VerticalAlignment="Center" Foreground="Gray"/>
  </StackPanel>
</Grid>
                        <GroupBox Grid.Column="1" Header="Metadata (read-only)" Margin="8,0,0,0" x:Name="grpMeta" Visibility="Collapsed">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <TextBox x:Name="txtMeta" FontFamily="Consolas" FontSize="12" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap"/>
                            </ScrollViewer>
                        </GroupBox>
                    </Grid>
                </DockPanel>
            </GroupBox>

            <!-- Preview -->
            <GroupBox Header="Code Preview" Grid.Column="4" Grid.Row="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock x:Name="lblSelected" Text="(hover or select a code)" Margin="6,2"/>
                    <TextBox x:Name="txtPreview" Grid.Row="1" Margin="6" FontFamily="Consolas" FontSize="13"
                             VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"
                             AcceptsReturn="True" TextWrapping="NoWrap" IsReadOnly="True"/>
                </Grid>
            </GroupBox>

            <!-- Bottom controls / log -->
            <GroupBox Header="Run / Backups" Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="5" Padding="6">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="170"/>
                        <ColumnDefinition Width="140"/>
                        <ColumnDefinition Width="130"/>
                        <ColumnDefinition Width="140"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Horizontal">
                        <TextBlock Text="patcher.exe:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <TextBox x:Name="txtPatcher" Width="380" IsReadOnly="True" Margin="0,0,6,0"/>
                        <Button Content="Browse..." Click="BrowsePatcher_Click" Margin="0,0,6,0"/>
                        <CheckBox x:Name="chkBackup" Content="Backup before patch" Margin="10,0,0,0"/>

                        <TextBlock Text="Selection:" VerticalAlignment="Center" Margin="10,0,6,0"/>
                        <TextBlock x:Name="txtSelection" FontWeight="Bold" VerticalAlignment="Center"/>
                    </StackPanel>

                    <Button Grid.Column="1" Grid.Row="0" Content="Run" Width="120" Height="32" HorizontalAlignment="Left" Visibility="Collapsed" IsEnabled="False" />
                    <Button Grid.Column="2" Grid.Row="0" Content="Clear Log" Width="110" Height="32" HorizontalAlignment="Left" Click="ClearLog_Click"/>
                    <Button Grid.Column="3" Grid.Row="0" Content="Open Backups" Width="120" Height="32" Click="OpenBackups_Click"/>
                    <Button Grid.Column="4" Grid.Row="0" Content="Restore Backup..." Width="120" Height="32" Click="RestoreBackup_Click"/>

                    <TextBox x:Name="txtLog" Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="5" Margin="0,6,0,0"
                             VerticalScrollBarVisibility="Auto" AcceptsReturn="True" IsReadOnly="True"
                             TextWrapping="NoWrap" FontFamily="Consolas" FontSize="12" local:AutoScrollBehavior.AutoScroll="True"/>
                </Grid>
            </GroupBox>
        </Grid>
    </DockPanel>
</Window>
