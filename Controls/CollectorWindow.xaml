<Window x:Class="ApolloGUI.CollectorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Code Collector" Height="560" Width="460"
        KeyDown="Window_KeyDown">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVis"/>
  </Window.Resources>

  <!-- Layout:
       Row 0: Top toolbar (Collector label + See Codes toggle)
       Row 1: Main content (Left fixed Names pane | Splitter | Right preview pane)
       Row 2: Bottom button bar (Patch File | Apply All | Clear) -->
  <Grid Margin="8">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="420"/>   <!-- Fixed width left pane -->
      <ColumnDefinition Width="5"/>     <!-- Splitter -->
      <ColumnDefinition Width="*"/>     <!-- Preview expands -->
    </Grid.ColumnDefinitions>

    <!-- Top toolbar -->
    <StackPanel Grid.Row="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,0,0,6">
      <TextBlock Text="Collector" FontWeight="Bold" Margin="0,0,12,0"/>
      <ToggleButton x:Name="SeeCodesToggle"
                    Content="See Codes"
                    IsChecked="{Binding SeeCodesEnabled, RelativeSource={RelativeSource AncestorType=Window}}"
                    Width="110" Height="28"/>
    </StackPanel>

    <!-- Left: Names pane (fixed width) -->
    <Grid Grid.Row="1" Grid.Column="0">
      <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>
      <!-- List of collected items with checkboxes; the ListBox itself scrolls -->
      <ListBox x:Name="List" ItemsSource="{Binding Entries}"
               Grid.Row="0"
               BorderBrush="#FFBEBEBE" BorderThickness="1"
               SelectionMode="Single"
               SelectionChanged="List_SelectionChanged">
    <ListBox.ItemContainerStyle>
      <Style TargetType="ListBoxItem">
        <EventSetter Event="PreviewMouseLeftButtonDown" Handler="ListItem_PreviewMouseLeftButtonDown"/>
      </Style>
    </ListBox.ItemContainerStyle>

        <ListBox.ItemTemplate>
          <DataTemplate>
            <CheckBox Content="{Binding Name}" IsChecked="{Binding IsChecked, Mode=TwoWay}" Margin="6,4,6,4"/>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </Grid>

    <!-- Splitter -->
    <GridSplitter Grid.Row="1" Grid.Column="1" Width="5"
                  HorizontalAlignment="Stretch" ResizeBehavior="PreviousAndNext"
                  ShowsPreview="True" Background="#22000000"/>

    <!-- Right: Code Preview pane; only visible when toggle is ON -->
    <Grid Grid.Row="1" Grid.Column="2" x:Name="CodePreviewContainer"
          Visibility="{Binding SeeCodesEnabled, Converter={StaticResource BoolToVis}, RelativeSource={RelativeSource AncestorType=Window}}">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>
      <TextBlock Text="Code Preview" FontWeight="Bold" Margin="6,4,6,4"/>
      <ScrollViewer Grid.Row="1" Margin="6">
    <!-- wide enough for '20000004 459C4000 20000004 459C4000' -->
		<TextBox x:Name="CodePreviewText"
                 IsReadOnly="True"
                 TextWrapping="NoWrap"
                 FontFamily="Consolas"
                 FontSize="13"
                 MinWidth="560"   
                 VerticalScrollBarVisibility="Auto"
                 HorizontalScrollBarVisibility="Auto"/>
      </ScrollViewer>
    </Grid>

    <!-- Bottom button bar -->
    <StackPanel Grid.Row="2" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,6,0,0">
      <Button Content="Apply Checkmarked" Width="110" Height="28" Margin="0,0,8,0" Click="Patch_Checked_Click"/>
      <Button Content="Apply All" Width="110" Height="28" Margin="0,0,8,0" Click="ApplyAll_Click"/>
      <Button Content="Clear" Width="90" Height="28" Click="Clear_Click"/>
    </StackPanel>
  </Grid>
</Window>
